<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài giảng: Sự Nóng Chảy & Sự Hóa Hơi - Thầy Lâm</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0KOVEMQNogPSesLpv5Fl5dokSDltihLAuhjJpcUGGlc/CUIa/ImFSH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlGwcjNTAIOOTenRwTBXdmRQwI7CMiUI/bosXvLG7FmUYMAHDDEEOoGfdEu" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" xintegrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>

    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
        }
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        .tab-content.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .tab-btn {
            color: #64748B;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        .tab-btn:hover {
            color: #0F172A;
        }
        .tab-btn.active {
            color: #F97316;
            border-bottom-color: #F97316;
            font-weight: 700;
        }
         .tab-btn.quiz-tab.active {
             color: #16A34A;
             border-bottom-color: #16A34A;
        }
        .quiz-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .quiz-option.correct {
            background-color: #16A34A;
            color: white;
            border-color: #16A34A;
        }
        .quiz-option.incorrect {
            background-color: #DC2626;
            color: white;
            border-color: #DC2626;
        }
        canvas {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
        }
        /* CSS cho modal */
        #javalab-modal {
            z-index: 1000;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-blue-800" data-translate="main_title">Bài Giảng Vật Lý Cùng Thầy Lâm</h1>
            <p class="text-xl mt-2 text-orange-500 font-semibold" data-translate="main_subtitle">Chủ đề: Khám Phá Sự Chuyển Thể</p>
             <div class="mt-4 flex justify-center items-center space-x-4">
                 <a href="https://drive.google.com/file/d/1ecDZpW6Ie8x9YsE-qDT5VQaa7f6LLZAQ/view?usp=sharing" target="_blank" class="inline-block bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition shadow">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="inline-block w-5 h-5 mr-2 -mt-1"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
                    <span data-translate="ref_doc_btn">Tài liệu tham khảo</span>
                </a>
                <button id="lang-switcher" class="bg-gray-700 text-white px-6 py-2 rounded-lg hover:bg-gray-800 transition shadow">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="inline-block w-5 h-5 mr-2 -mt-1"><path d="m5 8 6 6"></path><path d="m4 14 6-6 2-3"></path><path d="M2 5h12"></path><path d="M7 2h1"></path><path d="m22 22-5-10-5 10"></path><path d="M14 18h6"></path></svg>
                    <span data-translate="lang_switch_btn">Chuyển sang tiếng Đức</span>
                </button>
            </div>
        </header>

        <div class="mb-8 border-b border-slate-200">
            <div class="flex -mb-px space-x-2 md:space-x-6 justify-center overflow-x-auto pb-2">
                <button class="tab-btn active text-sm md:text-base py-3 px-3 whitespace-nowrap" onclick="changeTab(event, 'tab1')" data-translate="tab1_btn">1. Sự Nóng Chảy</button>
                <button class="tab-btn text-sm md:text-base py-3 px-3 whitespace-nowrap" onclick="changeTab(event, 'tab2')" data-translate="tab2_btn">2. Sự Hóa Hơi</button>
                <button class="tab-btn quiz-tab text-sm md:text-base py-3 px-3 whitespace-nowrap" onclick="changeTab(event, 'tab3')" data-translate="tab3_btn">3. Ứng Dụng & Kiểm Tra</button>
            </div>
        </div>

        <main id="tab-container">
            <!-- Tab 1: Sự Nóng Chảy -->
            <div id="tab1" class="tab-content active">
                <div class="bg-white p-6 rounded-lg shadow-md mb-8 grid md:grid-cols-2 gap-8 items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-blue-700 mb-4" data-translate="tab1_sec_a_title">A. Kiến thức Nền tảng</h2>
                        <div class="space-y-4 text-slate-700">
                            <h3 class="font-semibold text-lg text-slate-800" data-translate="tab1_sec_a_subtitle1">1. Định nghĩa & Công thức</h3>
                            <p data-translate="tab1_sec_a_p1">Nhiệt lượng cần truyền cho một vật rắn để nó nóng chảy hoàn toàn ở nhiệt độ nóng chảy phụ thuộc vào khối lượng của vật và tính chất của chất làm vật. Đại lượng đặc trưng cho khả năng này là <strong>nhiệt nóng chảy riêng ($\lambda$)</strong>.</p>
                            <p data-translate="tab1_sec_a_p2"><strong>Công thức tính nhiệt lượng nóng chảy:</strong></p>
                            <div class="bg-blue-50 text-blue-800 p-4 rounded-lg text-center text-xl">$Q = m \cdot \lambda$</div>
                            <p data-translate="tab1_sec_a_p3"><strong>Định nghĩa:</strong> Nhiệt nóng chảy riêng của một chất là nhiệt lượng cần thiết để 1kg chất đó chuyển hoàn toàn từ thể rắn sang thể lỏng ở nhiệt độ nóng chảy.</p>
                        </div>
                    </div>
                     <div class="flex flex-col items-center justify-center min-h-[350px]">
                        <h3 class="text-xl font-semibold mb-4 text-center" data-translate="sim_molecule_title">Mô phỏng phân tử</h3>
                        <canvas id="melting-canvas" width="300" height="250"></canvas>
                        <button id="start-melting-btn" class="mt-4 bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition" data-translate="start_sim_btn">Bắt đầu mô phỏng</button>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-md mb-8 grid md:grid-cols-2 gap-8 items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-blue-700 mb-4" data-translate="tab1_sec_b_title">B. Quá trình & Đồ thị</h2>
                        <div class="space-y-4 text-slate-700">
                             <p data-translate="tab1_sec_b_p1">Khi đun một cục đá, quá trình diễn ra theo 3 giai đoạn, được minh họa trên đồ thị nhiệt độ - thời gian:</p>
                             <ul class="list-decimal list-inside ml-4 space-y-1">
                                 <li data-translate="tab1_sec_b_li1"><strong>Giai đoạn 1 (Dốc lên):</strong> Nhiệt độ của đá tăng từ dưới 0°C lên đến 0°C.</li>
                                 <li data-translate="tab1_sec_b_li2"><strong>Giai đoạn 2 (Nằm ngang):</strong> Nhiệt độ không đổi ở 0°C. Năng lượng cung cấp lúc này dùng hoàn toàn để phá vỡ liên kết, giúp đá tan chảy.</li>
                                 <li data-translate="tab1_sec_b_li3"><strong>Giai đoạn 3 (Dốc lên):</strong> Khi đá tan hết, nhiệt độ của nước bắt đầu tăng.</li>
                             </ul>
                        </div>
                         <hr class="my-6 border-slate-200">
                         <h3 class="text-2xl font-bold text-orange-600 mb-4" data-translate="thaylam_pov_title">Góc nhìn Thầy Lâm</h3>
                          <p class="text-slate-700" data-translate="tab1_thaylam_pov">Hãy tưởng tượng các phân tử trong cục đá đang bị "giam cầm" trong một "nhà tù" trật tự. Để được "tự do" và chuyển thành lỏng, chúng phải trả một khoản "phí qua cửa". Nhiệt lượng ta cung cấp trong lúc nóng chảy chính là khoản phí đó. Nó không làm các phân tử "giàu" (nóng) lên, mà chỉ vừa đủ để chúng "mua vé" ra ngoài thôi!</p>
                    </div>
                    <div class="flex flex-col items-center justify-center min-h-[350px]">
                        <h3 class="text-xl font-semibold mb-4 text-center" data-translate="sim_graph_title">Mô phỏng đồ thị</h3>
                        <svg id="svg-melting-graph" width="350" height="250" class="bg-slate-50 border rounded-lg"></svg>
                        <button class="mt-4 bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition" onclick="animateMeltingGraph()" data-translate="draw_graph_btn">Vẽ đồ thị</button>
                    </div>
                </div>
            </div>

            <!-- Tab 2: Sự Hóa Hơi -->
            <div id="tab2" class="tab-content">
                 <div class="bg-white p-6 rounded-lg shadow-md mb-8 grid md:grid-cols-2 gap-8 items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-blue-700 mb-4" data-translate="tab2_sec_a_title">A. Kiến thức Nền tảng</h2>
                         <div class="space-y-4 text-slate-700">
                             <h3 class="font-semibold text-lg text-slate-800" data-translate="tab2_sec_a_subtitle1">1. Định nghĩa & Công thức</h3>
                             <p data-translate="tab2_sec_a_p1">Tương tự sự nóng chảy, để một chất lỏng hóa hơi hoàn toàn ở nhiệt độ sôi, ta cần cung cấp một nhiệt lượng. Đại lượng đặc trưng cho quá trình này là <strong>nhiệt hóa hơi riêng (L)</strong>.</p>
                             <p data-translate="tab2_sec_a_p2"><strong>Công thức tính nhiệt lượng hóa hơi:</strong></p>
                             <div class="bg-blue-50 text-blue-800 p-4 rounded-lg text-center text-xl">$Q = L \cdot m$</div>
                             <p data-translate="tab2_sec_a_p3"><strong>Định nghĩa:</strong> Nhiệt hóa hơi riêng của một chất là nhiệt lượng cần thiết để 1kg chất đó chuyển hoàn toàn từ thể lỏng sang thể khí (hơi) ở nhiệt độ sôi.</p>
                         </div>
                    </div>
                     <div class="flex flex-col items-center justify-center min-h-[350px]">
                        <h3 class="text-xl font-semibold mb-4 text-center" data-translate="sim_boiling_title">Mô phỏng hóa hơi</h3>
                        <canvas id="boiling-canvas" width="300" height="250"></canvas>
                        <button class="mt-4 bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition" onclick="startBoiling()" data-translate="start_sim_btn">Bắt đầu mô phỏng</button>
                    </div>
                </div>

                 <div class="bg-white p-6 rounded-lg shadow-md mb-8 grid md:grid-cols-2 gap-8 items-center">
                    <div>
                         <h2 class="text-2xl font-bold text-blue-700 mb-4" data-translate="tab2_sec_b_title">B. Quá trình & Đồ thị</h2>
                         <div class="space-y-4 text-slate-700">
                             <p data-translate="tab2_sec_b_p1">Khi đun sôi nước, quá trình cũng có các giai đoạn tương tự nóng chảy:</p>
                             <ul class="list-decimal list-inside ml-4 space-y-1">
                                 <li data-translate="tab2_sec_b_li1"><strong>Giai đoạn 1 (Dốc lên):</strong> Nhiệt độ của nước tăng từ nhiệt độ phòng đến 100°C.</li>
                                 <li data-translate="tab2_sec_b_li2"><strong>Giai đoạn 2 (Nằm ngang):</strong> Nhiệt độ không đổi ở 100°C. Năng lượng cung cấp lúc này dùng để "thắng" áp suất khí quyển và giúp nước hóa hơi.</li>
                                 <li data-translate="tab2_sec_b_li3"><strong>Giai đoạn 3 (Dốc lên):</strong> Nếu có thể giữ hơi nước lại và tiếp tục đun, nhiệt độ của hơi sẽ tăng.</li>
                             </ul>
                         </div>
                          <hr class="my-6 border-slate-200">
                          <h2 class="text-2xl font-bold text-orange-600 mb-4" data-translate="thaylam_pov_title">Góc nhìn Thầy Lâm</h2>
                          <div class="space-y-4 text-slate-700">
                              <p data-translate="tab2_thaylam_pov">Nếu nóng chảy là "mua vé qua cửa", thì hóa hơi chính là "mua vé máy bay hạng thương gia". Các phân tử nước không chỉ cần phá vỡ liên kết lỏng lẻo, mà còn cần một nguồn năng lượng cực lớn để "thăng cấp", bay vút lên bầu trời và trở thành hơi. Khoản năng lượng khổng lồ này chính là nhiệt hóa hơi riêng L.</p>
                          </div>
                    </div>
                     <div class="flex flex-col items-center justify-center min-h-[350px]">
                        <h3 class="text-xl font-semibold mb-4 text-center" data-translate="sim_graph_title">Mô phỏng đồ thị</h3>
                        <svg id="svg-boiling-graph" width="350" height="250" class="bg-slate-50 border rounded-lg"></svg>
                        <button class="mt-4 bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition" onclick="animateBoilingGraph()" data-translate="draw_graph_btn">Vẽ đồ thị</button>
                    </div>
                </div>
                 <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                     <h2 class="text-2xl font-bold text-blue-700 mb-4" data-translate="tab2_sec_c_title">C. Thí nghiệm Mở rộng</h2>
                     <p class="mb-4 text-slate-700" data-translate="tab2_sec_c_p1">Để khám phá sâu hơn về điểm sôi và áp suất, em có thể tương tác với mô phỏng thí nghiệm từ JavaLab ngay tại đây.</p>
                     <button onclick="openModal()" class="bg-teal-500 text-white px-5 py-2 rounded-lg hover:bg-teal-600 transition shadow">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="inline w-5 h-5 mr-2 -mt-1"><path d="M15 3h6v6"></path><path d="M10 14 21 3"></path><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h6"></path></svg>
                        <span data-translate="open_javalab_btn">Mở Thí Nghiệm JavaLab</span>
                    </button>
                 </div>
            </div>

            <!-- Tab 3: Ứng Dụng & Kiểm tra -->
            <div id="tab3" class="tab-content">
                <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                     <h2 class="text-2xl font-bold text-blue-700 mb-4" data-translate="tab3_sec_a_title">Phần 1: So sánh Nóng chảy và Hóa hơi</h2>
                     <table class="w-full text-left border-collapse">
                         <thead>
                             <tr class="bg-slate-100">
                                 <th class="p-3 border" data-translate="table_col1">Đặc điểm</th>
                                 <th class="p-3 border" data-translate="table_col2">Sự Nóng Chảy</th>
                                 <th class="p-3 border" data-translate="table_col3">Sự Hóa Hơi</th>
                             </tr>
                         </thead>
                         <tbody>
                             <tr>
                                 <td class="p-3 border font-semibold" data-translate="table_row1_1">Chuyển thể</td>
                                 <td class="p-3 border" data-translate="table_row1_2">Rắn → Lỏng</td>
                                 <td class="p-3 border" data-translate="table_row1_3">Lỏng → Khí (Hơi)</td>
                             </tr>
                             <tr>
                                 <td class="p-3 border font-semibold" data-translate="table_row2_1">Nhiệt độ</td>
                                 <td class="p-3 border" data-translate="table_row2_2">Không đổi ở nhiệt độ nóng chảy</td>
                                 <td class="p-3 border" data-translate="table_row2_3">Không đổi ở nhiệt độ sôi</td>
                             </tr>
                              <tr>
                                 <td class="p-3 border font-semibold" data-translate="table_row3_1">Đại lượng</td>
                                 <td class="p-3 border" data-translate="table_row3_2">Nhiệt nóng chảy riêng ($\lambda$)</td>
                                 <td class="p-3 border" data-translate="table_row3_3">Nhiệt hóa hơi riêng (L)</td>
                             </tr>
                             <tr>
                                 <td class="p-3 border font-semibold" data-translate="table_row4_1">Năng lượng</td>
                                 <td class="p-3 border" data-translate="table_row4_2">Phá vỡ liên kết tinh thể</td>
                                 <td class="p-3 border" data-translate="table_row4_3">Phá vỡ liên kết lỏng & thắng áp suất ngoài</td>
                             </tr>
                         </tbody>
                     </table>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                     <h2 class="text-2xl font-bold text-blue-700 mb-4" data-translate="tab3_sec_b_title">Phần 2: Ứng dụng đời sống</h2>
                     <div class="grid md:grid-cols-2 gap-8 items-center">
                         <div>
                            <h3 class="font-semibold text-lg text-slate-800 mb-2" data-translate="tab3_app_melting_title">Ứng dụng của sự nóng chảy:</h3>
                            <p data-translate="tab3_app_melting_p1"><strong>Ướp lạnh thực phẩm:</strong> Đá phải thu một lượng nhiệt lớn từ thực phẩm để tan chảy, qua đó làm lạnh và bảo quản chúng. Đây là lý do đá giữ lạnh tốt hơn nước lạnh rất nhiều!</p>
                             <h3 class="font-semibold text-lg text-slate-800 mt-4 mb-2" data-translate="tab3_app_boiling_title">Ứng dụng của sự hóa hơi:</h3>
                             <p data-translate="tab3_app_boiling_p1"><strong>Nồi áp suất:</strong> Bằng cách tăng áp suất, nồi làm tăng nhiệt độ sôi của nước, giúp thức ăn chín nhanh hơn. Khi xả van, hơi nước mang theo một lượng nhiệt lớn thoát ra ngoài.</p>
                             <p class="mt-2" data-translate="tab3_app_boiling_p2"><strong>Làm mát:</strong> Khi ta đổ mồ hôi, mồ hôi bay hơi và lấy đi một lượng nhiệt lớn trên da, giúp cơ thể hạ nhiệt.</p>
                         </div>
                         <div class="flex flex-col items-center justify-center">
                            <h3 class="text-xl font-semibold mb-4 text-center" data-translate="sim_ice_cup_title">Mô phỏng: Ly nước đá "thần kỳ"</h3>
                            <svg id="svg-tab3" width="300" height="200" viewBox="0 0 300 200"></svg>
                            <button class="mt-4 bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition" onclick="animateApplication()" data-translate="view_app_btn">Xem ứng dụng</button>
                        </div>
                     </div>
                </div>

                <div id="quiz-container" class="max-w-3xl mx-auto bg-white p-8 rounded-xl shadow-lg">
                    <h2 class="text-2xl font-bold text-center text-green-700 mb-6" data-translate="quiz_title">Phần 3: Kiểm Tra Kiến Thức</h2>
                    <div id="quiz-question" class="text-lg font-semibold mb-6 min-h-[50px]"></div>
                    <div id="quiz-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    <button id="quiz-next-btn" class="w-full mt-8 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition font-bold hidden" data-translate="next_question_btn">Câu tiếp theo</button>
                </div>
                <div id="quiz-results" class="hidden max-w-3xl mx-auto bg-white p-8 rounded-xl shadow-lg text-center">
                     <h2 class="text-3xl font-bold text-green-700 mb-4" data-translate="quiz_result_title">Hoàn thành!</h2>
                     <p class="text-lg mb-2" data-translate="quiz_result_p1">Kết quả của em:</p>
                     <p id="quiz-score" class="text-5xl font-bold text-orange-500 my-4"></p>
                     <p id="quiz-feedback" class="text-slate-600 font-style: italic"></p>
                     <button class="mt-8 bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition font-bold" onclick="restartQuiz()" data-translate="restart_quiz_btn">Làm lại</button>
                </div>
            </div>

        </main>
    </div>

    <!-- THÊM MỚI: Modal cho JavaLab -->
    <div id="javalab-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-5xl h-[90vh] flex flex-col">
            <div class="p-3 border-b flex justify-between items-center bg-slate-50 rounded-t-lg">
                <h3 class="font-bold text-slate-700" data-translate="javalab_title">Thí nghiệm từ JavaLab.org</h3>
                <button onclick="closeModal()" class="px-3 py-1 bg-red-500 text-white rounded-full text-lg font-bold hover:bg-red-600 transition">&times;</button>
            </div>
            <iframe id="javalab-iframe" class="w-full h-full border-0" allow="fullscreen"></iframe>
        </div>
    </div>


    <script>
        // --------- HỆ THỐNG DỊCH THUẬT ---------
        let currentLanguage = 'vi';

        const translations = {
            // Header
            main_title: { vi: "Bài Giảng Vật Lý Cùng Thầy Lâm", de: "Physikvortrag mit Herrn Lâm" },
            main_subtitle: { vi: "Chủ đề: Khám Phá Sự Chuyển Thể", de: "Thema: Aggregatzustände Entdecken" },
            ref_doc_btn: { vi: "Tài liệu tham khảo", de: "Referenzdokument" },
            lang_switch_btn: { vi: "Chuyển sang tiếng Đức", de: "Auf Deutsch umstellen" },
            // Tabs
            tab1_btn: { vi: "1. Sự Nóng Chảy", de: "1. Schmelzen" },
            tab2_btn: { vi: "2. Sự Hóa Hơi", de: "2. Verdampfung" },
            tab3_btn: { vi: "3. Ứng Dụng & Kiểm Tra", de: "3. Anwendung & Test" },
            // Tab 1
            tab1_sec_a_title: { vi: "A. Kiến thức Nền tảng", de: "A. Grundlagen" },
            tab1_sec_a_subtitle1: { vi: "1. Định nghĩa & Công thức", de: "1. Definition & Formel" },
            tab1_sec_a_p1: { vi: `Nhiệt lượng cần truyền cho một vật rắn để nó nóng chảy hoàn toàn ở nhiệt độ nóng chảy phụ thuộc vào khối lượng của vật và tính chất của chất làm vật. Đại lượng đặc trưng cho khả năng này là <strong>nhiệt nóng chảy riêng ($\lambda$)</strong>.`, de: `Die Wärmemenge, die benötigt wird, um einen Festkörper bei seiner Schmelztemperatur vollständig zu schmelzen, hängt von seiner Masse und den Materialeigenschaften ab. Die charakteristische Größe dafür ist die <strong>spezifische Schmelzwärme ($\lambda$)</strong>.` },
            tab1_sec_a_p2: { vi: "<strong>Công thức tính nhiệt lượng nóng chảy:</strong>", de: "<strong>Formel für die Schmelzwärme:</strong>" },
            tab1_sec_a_p3: { vi: `<strong>Định nghĩa:</strong> Nhiệt nóng chảy riêng của một chất là nhiệt lượng cần thiết để 1kg chất đó chuyển hoàn toàn từ thể rắn sang thể lỏng ở nhiệt độ nóng chảy.`, de: `<strong>Definition:</strong> Die spezifische Schmelzwärme einer Substanz ist die Wärmemenge, die benötigt wird, um 1 kg dieser Substanz bei der Schmelztemperatur vollständig vom festen in den flüssigen Zustand zu überführen.` },
            sim_molecule_title: { vi: "Mô phỏng phân tử", de: "Molekulare Simulation" },
            start_sim_btn: { vi: "Bắt đầu mô phỏng", de: "Simulation starten" },
            tab1_sec_b_title: { vi: "B. Quá trình & Đồ thị", de: "B. Prozess & Diagramm" },
            tab1_sec_b_p1: { vi: "Khi đun một cục đá, quá trình diễn ra theo 3 giai đoạn, được minh họa trên đồ thị nhiệt độ - thời gian:", de: "Beim Erhitzen von Eis verläuft der Prozess in 3 Phasen, die im Temperatur-Zeit-Diagramm dargestellt sind:" },
            tab1_sec_b_li1: { vi: "<strong>Giai đoạn 1 (Dốc lên):</strong> Nhiệt độ của đá tăng từ dưới 0°C lên đến 0°C.", de: "<strong>Phase 1 (Ansteigend):</strong> Die Temperatur des Eises steigt von unter 0°C auf 0°C." },
            tab1_sec_b_li2: { vi: `<strong>Giai đoạn 2 (Nằm ngang):</strong> Nhiệt độ không đổi ở 0°C. Năng lượng cung cấp lúc này dùng hoàn toàn để phá vỡ liên kết, giúp đá tan chảy.`, de: `<strong>Phase 2 (Horizontal):</strong> Die Temperatur bleibt konstant bei 0°C. Die zugeführte Energie wird vollständig zum Aufbrechen der Bindungen verwendet, wodurch das Eis schmilzt.` },
            tab1_sec_b_li3: { vi: "<strong>Giai đoạn 3 (Dốc lên):</strong> Khi đá tan hết, nhiệt độ của nước bắt đầu tăng.", de: "<strong>Phase 3 (Ansteigend):</strong> Sobald das gesamte Eis geschmolzen ist, beginnt die Temperatur des Wassers zu steigen." },
            thaylam_pov_title: { vi: "Góc nhìn Thầy Lâm", de: "Herrn Lâms Perspektive" },
            tab1_thaylam_pov: { vi: `Hãy tưởng tượng các phân tử trong cục đá đang bị "giam cầm" trong một "nhà tù" trật tự. Để được "tự do" và chuyển thành lỏng, chúng phải trả một khoản "phí qua cửa". Nhiệt lượng ta cung cấp trong lúc nóng chảy chính là khoản phí đó. Nó không làm các phân tử "giàu" (nóng) lên, mà chỉ vừa đủ để chúng "mua vé" ra ngoài thôi!`, de: `Stellen Sie sich vor, die Moleküle im Eis sind in einem geordneten "Gefängnis" eingesperrt. Um "frei" zu werden und flüssig zu werden, müssen sie eine "Eintrittsgebühr" zahlen. Die Wärme, die wir während des Schmelzens zuführen, ist diese Gebühr. Sie macht die Moleküle nicht "reicher" (heißer), sondern reicht gerade aus, um ihnen ein "Ticket" nach draußen zu kaufen!` },
            sim_graph_title: { vi: "Mô phỏng đồ thị", de: "Diagrammsimulation" },
            draw_graph_btn: { vi: "Vẽ đồ thị", de: "Diagramm zeichnen" },
            // Tab 2
            tab2_sec_a_title: { vi: "A. Kiến thức Nền tảng", de: "A. Grundlagen" },
            tab2_sec_a_subtitle1: { vi: "1. Định nghĩa & Công thức", de: "1. Definition & Formel" },
            tab2_sec_a_p1: { vi: `Tương tự sự nóng chảy, để một chất lỏng hóa hơi hoàn toàn ở nhiệt độ sôi, ta cần cung cấp một nhiệt lượng. Đại lượng đặc trưng cho quá trình này là <strong>nhiệt hóa hơi riêng (L)</strong>.`, de: `Ähnlich wie beim Schmelzen wird eine Wärmemenge benötigt, um eine Flüssigkeit bei ihrer Siedetemperatur vollständig zu verdampfen. Die charakteristische Größe für diesen Prozess ist die <strong>spezifische Verdampfungswärme (L)</strong>.` },
            tab2_sec_a_p2: { vi: "<strong>Công thức tính nhiệt lượng hóa hơi:</strong>", de: "<strong>Formel für die Verdampfungswärme:</strong>" },
            tab2_sec_a_p3: { vi: `<strong>Định nghĩa:</strong> Nhiệt hóa hơi riêng của một chất là nhiệt lượng cần thiết để 1kg chất đó chuyển hoàn toàn từ thể lỏng sang thể khí (hơi) ở nhiệt độ sôi.`, de: `<strong>Definition:</strong> Die spezifische Verdampfungswärme einer Substanz ist die Wärmemenge, die benötigt wird, um 1 kg dieser Substanz bei der Siedetemperatur vollständig vom flüssigen in den gasförmigen Zustand zu überführen.` },
            sim_boiling_title: { vi: "Mô phỏng hóa hơi", de: "Verdampfungssimulation" },
            tab2_sec_b_title: { vi: "B. Quá trình & Đồ thị", de: "B. Prozess & Diagramm" },
            tab2_sec_b_p1: { vi: "Khi đun sôi nước, quá trình cũng có các giai đoạn tương tự nóng chảy:", de: "Beim Kochen von Wasser gibt es ähnliche Phasen wie beim Schmelzen:" },
            tab2_sec_b_li1: { vi: "<strong>Giai đoạn 1 (Dốc lên):</strong> Nhiệt độ của nước tăng từ nhiệt độ phòng đến 100°C.", de: "<strong>Phase 1 (Ansteigend):</strong> Die Temperatur des Wassers steigt von Raumtemperatur auf 100°C." },
            tab2_sec_b_li2: { vi: `<strong>Giai đoạn 2 (Nằm ngang):</strong> Nhiệt độ không đổi ở 100°C. Năng lượng cung cấp lúc này dùng để "thắng" áp suất khí quyển và giúp nước hóa hơi.`, de: `<strong>Phase 2 (Horizontal):</strong> Die Temperatur bleibt konstant bei 100°C. Die zugeführte Energie wird verwendet, um den atmosphärischen Druck zu überwinden und das Wasser zu verdampfen.` },
            tab2_sec_b_li3: { vi: "<strong>Giai đoạn 3 (Dốc lên):</strong> Nếu có thể giữ hơi nước lại và tiếp tục đun, nhiệt độ của hơi sẽ tăng.", de: "<strong>Phase 3 (Ansteigend):</strong> Wenn der Dampf aufgefangen und weiter erhitzt wird, steigt seine Temperatur." },
            tab2_thaylam_pov: { vi: `Nếu nóng chảy là "mua vé qua cửa", thì hóa hơi chính là "mua vé máy bay hạng thương gia". Các phân tử nước không chỉ cần phá vỡ liên kết lỏng lẻo, mà còn cần một nguồn năng lượng cực lớn để "thăng cấp", bay vút lên bầu trời và trở thành hơi. Khoản năng lượng khổng lồ này chính là nhiệt hóa hơi riêng L.`, de: `Wenn Schmelzen ein "Eintrittsticket" ist, dann ist Verdampfen ein "First-Class-Flugticket". Wassermoleküle müssen nicht nur die losen Bindungen brechen, sondern benötigen auch eine riesige Energiemenge, um "aufzusteigen" und als Dampf in den Himmel zu schweben. Diese riesige Energiemenge ist die spezifische Verdampfungswärme L.` },
            tab2_sec_c_title: { vi: "C. Thí nghiệm Mở rộng", de: "C. Erweitertes Experiment" },
            tab2_sec_c_p1: { vi: "Để khám phá sâu hơn về điểm sôi và áp suất, em có thể tương tác với mô phỏng thí nghiệm từ JavaLab ngay tại đây.", de: "Um mehr über Siedepunkt und Druck zu erfahren, können Sie hier mit der JavaLab-Experimentalsimulation interagieren." },
            open_javalab_btn: { vi: "Mở Thí Nghiệm JavaLab", de: "JavaLab-Experiment öffnen" },
            javalab_title: { vi: "Thí nghiệm từ JavaLab.org", de: "Experiment von JavaLab.org" },
            // Tab 3
            tab3_sec_a_title: { vi: "Phần 1: So sánh Nóng chảy và Hóa hơi", de: "Teil 1: Vergleich von Schmelzen und Verdampfen" },
            table_col1: { vi: "Đặc điểm", de: "Merkmal" },
            table_col2: { vi: "Sự Nóng Chảy", de: "Schmelzen" },
            table_col3: { vi: "Sự Hóa Hơi", de: "Verdampfung" },
            table_row1_1: { vi: "Chuyển thể", de: "Zustandsänderung" },
            table_row1_2: { vi: "Rắn → Lỏng", de: "Fest → Flüssig" },
            table_row1_3: { vi: "Lỏng → Khí (Hơi)", de: "Flüssig → Gas (Dampf)" },
            table_row2_1: { vi: "Nhiệt độ", de: "Temperatur" },
            table_row2_2: { vi: "Không đổi ở nhiệt độ nóng chảy", de: "Konstant bei Schmelztemperatur" },
            table_row2_3: { vi: "Không đổi ở nhiệt độ sôi", de: "Konstant bei Siedetemperatur" },
            table_row3_1: { vi: "Đại lượng", de: "Größe" },
            table_row3_2: { vi: "Nhiệt nóng chảy riêng ($\lambda$)", de: "Spezifische Schmelzwärme ($\lambda$)" },
            table_row3_3: { vi: "Nhiệt hóa hơi riêng (L)", de: "Spezifische Verdampfungswärme (L)" },
            table_row4_1: { vi: "Năng lượng", de: "Energie" },
            table_row4_2: { vi: "Phá vỡ liên kết tinh thể", de: "Bricht Kristallbindungen" },
            table_row4_3: { vi: "Phá vỡ liên kết lỏng & thắng áp suất ngoài", de: "Bricht flüssige Bindungen & überwindet äußeren Druck" },
            tab3_sec_b_title: { vi: "Phần 2: Ứng dụng đời sống", de: "Teil 2: Anwendungen im Alltag" },
            tab3_app_melting_title: { vi: "Ứng dụng của sự nóng chảy:", de: "Anwendungen des Schmelzens:" },
            tab3_app_melting_p1: { vi: `<strong>Ướp lạnh thực phẩm:</strong> Đá phải thu một lượng nhiệt lớn từ thực phẩm để tan chảy, qua đó làm lạnh và bảo quản chúng. Đây là lý do đá giữ lạnh tốt hơn nước lạnh rất nhiều!`, de: `<strong>Lebensmittel kühlen:</strong> Eis muss eine große Wärmemenge aus den Lebensmitteln aufnehmen, um zu schmelzen, wodurch sie gekühlt und konserviert werden. Deshalb kühlt Eis viel besser als kaltes Wasser!` },
            tab3_app_boiling_title: { vi: "Ứng dụng của sự hóa hơi:", de: "Anwendungen der Verdampfung:" },
            tab3_app_boiling_p1: { vi: `<strong>Nồi áp suất:</strong> Bằng cách tăng áp suất, nồi làm tăng nhiệt độ sôi của nước, giúp thức ăn chín nhanh hơn. Khi xả van, hơi nước mang theo một lượng nhiệt lớn thoát ra ngoài.`, de: `<strong>Schnellkochtopf:</strong> Durch Erhöhen des Drucks erhöht der Topf den Siedepunkt von Wasser, wodurch Lebensmittel schneller garen. Beim Ablassen des Ventils entweicht Dampf mit einer großen Wärmemenge.` },
            tab3_app_boiling_p2: { vi: `<strong>Làm mát:</strong> Khi ta đổ mồ hôi, mồ hôi bay hơi và lấy đi một lượng nhiệt lớn trên da, giúp cơ thể hạ nhiệt.`, de: `<strong>Kühlung:</strong> Wenn wir schwitzen, verdunstet der Schweiß und entzieht unserer Haut eine große Wärmemenge, was dem Körper hilft, sich abzukühlen.` },
            sim_ice_cup_title: { vi: `Mô phỏng: Ly nước đá "thần kỳ"`, de: `Simulation: Das "magische" Glas Eiswasser` },
            view_app_btn: { vi: "Xem ứng dụng", de: "Anwendung ansehen" },
            quiz_title: { vi: "Phần 3: Kiểm Tra Kiến Thức", de: "Teil 3: Wissenstest" },
            next_question_btn: { vi: "Câu tiếp theo", de: "Nächste Frage" },
            quiz_result_title: { vi: "Hoàn thành!", de: "Abgeschlossen!" },
            quiz_result_p1: { vi: "Kết quả của em:", de: "Dein Ergebnis:" },
            restart_quiz_btn: { vi: "Làm lại", de: "Wiederholen" },
            // AI Chat
            chat_title: { vi: "Góc Tương Tác Cùng Thầy Lâm", de: "Interaktive Ecke mit Herrn Lâm" },
            chat_p1: { vi: "Em có câu hỏi gì về sự nóng chảy không?", de: "Haben Sie Fragen zum Schmelzen?" },
            chat_p2: { vi: "Em có thắc mắc gì về sự hóa hơi không? Hãy hỏi thầy!", de: "Haben Sie Fragen zur Verdunstung? Fragen Sie einfach!" },
            chat_placeholder1: { vi: "Ví dụ: Tại sao nhiệt độ không đổi khi đá tan?", de: "Z.B.: Warum ändert sich die Temperatur nicht, wenn Eis schmilzt?" },
            chat_placeholder2: { vi: "Ví dụ: Tại sao nước sôi ở 100 độ C?", de: "Z.B.: Warum kocht Wasser bei 100°C?" },
            chat_send_btn: { vi: "Gửi", de: "Senden" },
        };

        const quizData = [
            { question: {vi: "Trong quá trình nóng chảy, nhiệt độ của vật...", de: "Während des Schmelzens ist die Temperatur eines Objekts..."}, options: [{vi: "Tăng dần", de: "Steigend"}, {vi: "Giảm dần", de: "Fallend"}, {vi: "Không thay đổi", de: "Unverändert"}, {vi: "Tăng rồi giảm", de: "Steigend, dann fallend"}], correct: 2 },
            { question: {vi: "Công thức tính nhiệt lượng hóa hơi là:", de: "Die Formel zur Berechnung der Verdampfungswärme lautet:"}, options: ["Q = m.c.Δt", "Q = λ.m", "Q = L.m", "Q = m.g.h"], correct: 2 },
            { question: {vi: "Nhiệt hóa hơi riêng (L) có đơn vị là:", de: "Die Einheit der spezifischen Verdampfungswärme (L) ist:"}, options: ["J", "J/kg", "J/kg.°C", "°C"], correct: 1 },
            { question: {vi: "Tại sao mồ hôi bay hơi lại giúp cơ thể mát hơn?", de: "Warum hilft verdunstender Schweiß, den Körper zu kühlen?"}, options: [{vi: "Vì mồ hôi lạnh", de: "Weil Schweiß kalt ist"}, {vi: "Vì bay hơi là quá trình thu nhiệt lượng lớn", de: "Weil Verdunstung ein Prozess ist, der viel Wärme aufnimmt"}, {vi: "Vì gió thổi mát", de: "Weil der Wind kühl ist"}, {vi: "Vì da trở nên khô ráo", de: "Weil die Haut trocken wird"}], correct: 1 },
            { question: {vi: "Đoạn nằm ngang trên đồ thị sôi biểu thị điều gì?", de: "Was stellt der horizontale Abschnitt im Siedediagramm dar?"}, options: [{vi: "Nước đang nóng lên", de: "Das Wasser erwärmt sich"}, {vi: "Nước đang hóa hơi ở nhiệt độ không đổi", de: "Das Wasser verdampft bei konstanter Temperatur"}, {vi: "Nước đang nguội đi", de: "Das Wasser kühlt ab"}, {vi: "Nhiệt kế bị hỏng", de: "Das Thermometer ist kaputt"}], correct: 1 }
        ];

        function setLanguage(lang) {
            currentLanguage = lang;
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.dataset.translate;
                if (translations[key] && translations[key][lang]) {
                    el.innerHTML = translations[key][lang];
                }
            });
            // Cập nhật lại câu hỏi quiz nếu đang hiển thị
            if(document.getElementById('quiz-container').style.display !== 'none' && !document.getElementById('quiz-results').classList.contains('active')){
                showQuestion();
            }
             if (lang === 'de') {
                 document.documentElement.lang = 'de';
                 document.querySelector('[data-translate="lang_switch_btn"]').textContent = "Auf Vietnamesisch umstellen";
             } else {
                 document.documentElement.lang = 'vi';
                 document.querySelector('[data-translate="lang_switch_btn"]').textContent = "Chuyển sang tiếng Đức";
             }
        }

        // --------- HỆ THỐNG TAB ---------
        function changeTab(event, tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.currentTarget.classList.add('active');
            if (tabId === 'tab3') {
                drawApplicationScene(false);
            }
            if (window.renderMathInElement) {
                renderMathInElement(document.body, {
                     delimiters: [{left: "$", right: "$", display: false}]
                });
            }
        }

        // --------- CÁC HÀM MÔ PHỎNG ---------

        const setupMeltingCanvas = () => {
            const canvas = document.getElementById('melting-canvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const btn = document.getElementById('start-melting-btn');
            let particles = [], animationFrameId;
            const STATES = { IDLE: 'IDLE', HEATING: 'HEATING', MELTING: 'MELTING' };
            let currentState = STATES.IDLE;

            class Particle {
                constructor(x, y) { this.x = x; this.y = y; this.originX = x; this.originY = y; this.radius = 8; this.color = '#3b82f6'; this.vx = (Math.random() - 0.5) * 1.5; this.vy = (Math.random() - 0.5) * 1.5; this.vibrationAmplitude = 0; }
                draw() { ctx.beginPath(); ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2); ctx.fillStyle = this.color; ctx.fill(); }
                update() {
                    if (currentState === STATES.HEATING) { this.x = this.originX + (Math.random() - 0.5) * this.vibrationAmplitude; this.y = this.originY + (Math.random() - 0.5) * this.vibrationAmplitude; } 
                    else if (currentState === STATES.MELTING) { this.x += this.vx; this.y += this.vy; if (this.x < this.radius || this.x > canvas.width - this.radius) this.vx *= -1; if (this.y < this.radius || this.y > canvas.height - this.radius) this.vy *= -1; }
                }
            }

            function init() {
                currentState = STATES.IDLE;
                if (animationFrameId) cancelAnimationFrame(animationFrameId);
                particles = [];
                const padding = 40, numCols = 5, numRows = 5;
                const spacingX = (canvas.width - padding * 2) / (numCols - 1);
                const spacingY = (canvas.height - padding * 2) / (numRows - 1);
                for (let i = 0; i < numCols; i++) for (let j = 0; j < numRows; j++) particles.push(new Particle(padding + i * spacingX, padding + j * spacingY));
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particles.forEach(p => p.draw());
                btn.innerHTML = translations.start_sim_btn[currentLanguage];
                btn.disabled = false;
            }

            let globalVibration = 0;
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                if (currentState === STATES.HEATING) {
                    if (globalVibration < 8) globalVibration += 0.06;
                    else { currentState = STATES.MELTING; btn.innerHTML = (currentLanguage === 'vi' ? 'Thiết lập lại' : 'Zurücksetzen'); btn.disabled = false; }
                }
                particles.forEach(p => { if (currentState === STATES.HEATING) p.vibrationAmplitude = globalVibration; p.update(); p.draw(); });
                animationFrameId = requestAnimationFrame(animate);
            }
            btn.addEventListener('click', () => {
                if (currentState === STATES.IDLE) {
                    currentState = STATES.HEATING; globalVibration = 0;
                    btn.innerHTML = (currentLanguage === 'vi' ? 'Đang làm nóng...' : 'Erwärmung...');
                    btn.disabled = true;
                    animate();
                } else init();
            });
            init();
        }

        let boilingAnimationId = null;
        function startBoiling() {
            const canvas = document.getElementById('boiling-canvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            let bubbles = []; let waterLevel = 220;
            const btn = document.querySelector('button[onclick="startBoiling()"]');

            if (boilingAnimationId) {
                cancelAnimationFrame(boilingAnimationId);
                boilingAnimationId = null;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                btn.innerHTML = translations.start_sim_btn[currentLanguage];
                return;
            }
            
            btn.innerHTML = (currentLanguage === 'vi' ? 'Dừng lại' : 'Stopp');

            class Bubble {
                constructor() { this.x = Math.random() * (canvas.width - 40) + 20; this.y = waterLevel; this.radius = Math.random() * 4 + 1; this.vy = -Math.random() * 1.5 - 0.5; }
                draw() { ctx.beginPath(); ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2); ctx.strokeStyle = 'rgba(255,255,255,0.8)'; ctx.stroke(); }
                update() { this.y += this.vy; }
            }
            
            function animate() {
                ctx.fillStyle = '#f0f9ff'; 
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#3b82f6';
                ctx.fillRect(0, canvas.height - waterLevel, canvas.width, waterLevel);

                if (Math.random() < 0.6 && bubbles.length < 80) bubbles.push(new Bubble());
                
                for(let i = bubbles.length - 1; i >= 0; i--) {
                    bubbles[i].update(); bubbles[i].draw();
                    if(bubbles[i].y < canvas.height - waterLevel) bubbles.splice(i, 1);
                }

                if (waterLevel > 150) waterLevel -= 0.05;

                boilingAnimationId = requestAnimationFrame(animate);
            }
            animate();
        }

        function animateGraph(svgId, pathData) {
            const svg = document.getElementById(svgId);
            if (!svg) return;
            svg.innerHTML = '';
            const axisX = document.createElementNS("http://www.w3.org/2000/svg", "line");
            axisX.setAttribute("x1", 40); axisX.setAttribute("y1", 200); axisX.setAttribute("x2", 340); axisX.setAttribute("y2", 200);
            axisX.setAttribute("stroke", "#334155"); axisX.setAttribute("stroke-width", "2");
            const axisY = document.createElementNS("http://www.w3.org/2000/svg", "line");
            axisY.setAttribute("x1", 50); axisY.setAttribute("y1", 210); axisY.setAttribute("x2", 50); axisY.setAttribute("y2", 10);
            axisY.setAttribute("stroke", "#334155"); axisY.setAttribute("stroke-width", "2");
            svg.appendChild(axisX); svg.appendChild(axisY);
            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            path.setAttribute("d", pathData); path.setAttribute("fill", "none"); path.setAttribute("stroke", "#F97316"); path.setAttribute("stroke-width", "4"); path.setAttribute("stroke-linecap", "round");
            svg.appendChild(path);
            const pathLength = path.getTotalLength();
            path.setAttribute("stroke-dasharray", pathLength);
            path.setAttribute("stroke-dashoffset", pathLength);
            path.innerHTML = `<animate attributeName="stroke-dashoffset" from="${pathLength}" to="0" dur="2s" begin="0.5s" fill="freeze" calcMode="spline" keyTimes="0; 1" keySplines="0.42 0 0.58 1" />`;
        }
        function animateMeltingGraph() { animateGraph('svg-melting-graph', "M 50 180 L 120 150 L 250 150 L 320 80"); }
        function animateBoilingGraph() { animateGraph('svg-boiling-graph', "M 50 180 L 120 80 L 250 80 L 320 40"); }

        function drawApplicationScene(isAnimated = false) {
            const svg = document.getElementById('svg-tab3'); if (!svg) return; svg.innerHTML = ''; 
            const glass = document.createElementNS("http://www.w3.org/2000/svg", "path"); glass.setAttribute("d", "M80 30 L 100 180 H 200 L 220 30 Z"); glass.setAttribute("stroke", "#9CA3AF"); glass.setAttribute("stroke-width", "3"); glass.setAttribute("fill", "rgba(100,150,255,0.1)"); svg.appendChild(glass);
            const drink = document.createElementNS("http://www.w3.org/2000/svg", "path"); drink.setAttribute("d", "M85 50 L 100 170 H 200 L 215 50 Z"); drink.setAttribute("fill", "#FBBF24"); svg.appendChild(drink);
            const iceCube = document.createElementNS("http://www.w3.org/2000/svg", "rect"); iceCube.setAttribute("x", "130"); iceCube.setAttribute("y", "60"); iceCube.setAttribute("width", "40"); iceCube.setAttribute("height", "40"); iceCube.setAttribute("fill", "white"); iceCube.setAttribute("stroke", "#60A5FA"); iceCube.setAttribute("stroke-width", "2"); iceCube.setAttribute("rx", "5"); svg.appendChild(iceCube);
            if (isAnimated) { iceCube.innerHTML = `<animate attributeName="width" from="40" to="5" dur="8s" fill="freeze" /><animate attributeName="height" from="40" to="5" dur="8s" fill="freeze" /><animate attributeName="x" from="130" to="147.5" dur="8s" fill="freeze" /><animate attributeName="y" from="60" to="77.5" dur="8s" fill="freeze" /><animate attributeName="opacity" from="1" to="0" begin="7.5s" dur="0.5s" fill="freeze" />`; const heatPositions = [ { x: 105, y: 150 }, { x: 195, y: 150 }, { x: 110, y: 100 }, { x: 190, y: 100 }, { x: 120, y: 130 }, { x: 180, y: 130 } ]; const iceCenter = { x: 150, y: 80 }; heatPositions.forEach((pos, i) => { const heat = document.createElementNS("http://www.w3.org/2000/svg", "circle"); heat.setAttribute("cx", pos.x); heat.setAttribute("cy", pos.y); heat.setAttribute("r", "4"); heat.setAttribute("fill", "#ef4444"); heat.setAttribute("opacity", "0"); svg.appendChild(heat); heat.innerHTML = `<animate attributeName="opacity" values="0; 1; 1; 0" dur="2.5s" begin="${i * 0.5}s" repeatCount="indefinite" /><animateMotion path="M0,0 Q${(iceCenter.x - pos.x)*0.5},${(iceCenter.y - pos.y)*0.5} ${iceCenter.x - pos.x},${iceCenter.y - pos.y}" dur="2.5s" begin="${i * 0.5}s" repeatCount="indefinite" /><animate attributeName="r" from="4" to="0" dur="2.5s" begin="${i * 0.5}s" repeatCount="indefinite" />`; }); }
        }
        function animateApplication() { drawApplicationScene(true); }

        // --------- HỆ THỐNG QUIZ ---------
        let currentQuestionIndex = 0, score = 0;
        function startQuiz() {
            currentQuestionIndex = 0; score = 0;
            document.getElementById('quiz-container').style.display = 'block';
            document.getElementById('quiz-results').style.display = 'none';
            document.getElementById('quiz-next-btn').style.display = 'none';
            showQuestion();
        }
        function showQuestion() {
            const questionEl = document.getElementById('quiz-question');
            const optionsEl = document.getElementById('quiz-options');
            optionsEl.innerHTML = '';
            const q = quizData[currentQuestionIndex];
            questionEl.textContent = `${currentQuestionIndex + 1}. ${q.question[currentLanguage]}`;
            q.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.textContent = typeof option === 'string' ? option : option[currentLanguage];
                button.classList.add('quiz-option', 'p-4', 'border-2', 'rounded-lg', 'text-left', 'transition-all');
                button.addEventListener('click', () => selectAnswer(button, index));
                optionsEl.appendChild(button);
            });
        }
        function selectAnswer(selectedBtn, selectedIndex) {
            const correctIndex = quizData[currentQuestionIndex].correct;
            Array.from(document.getElementById('quiz-options').children).forEach((btn, index) => {
                btn.disabled = true;
                if (index === correctIndex) btn.classList.add('correct');
                else if (index === selectedIndex) btn.classList.add('incorrect');
            });
            if (selectedIndex === correctIndex) score++;
            document.getElementById('quiz-next-btn').style.display = 'block';
        }
        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < quizData.length) {
                document.getElementById('quiz-next-btn').style.display = 'none';
                showQuestion();
            } else showResults();
        }
        function showResults() {
            document.getElementById('quiz-container').style.display = 'none';
            const resultsContainer = document.getElementById('quiz-results');
            resultsContainer.style.display = 'block';
            document.getElementById('quiz-score').textContent = `${score}/${quizData.length}`;
            const percentage = (score / quizData.length) * 100;
            let feedback = { vi: "Cố gắng hơn nhé!", de: "Versuch es weiter!" };
            if (percentage === 100) feedback = { vi: "Tuyệt vời! Em đã là chuyên gia chuyển thể!", de: "Ausgezeichnet! Du bist ein Experte für Zustandsänderungen!" };
            else if (percentage >= 60) feedback = { vi: "Làm tốt lắm! Em đã nắm vững kiến thức.", de: "Gut gemacht! Du hast das Wissen gemeistert." };
            document.getElementById('quiz-feedback').textContent = feedback[currentLanguage];
        }
        function restartQuiz() { startQuiz(); }
        
        function openModal() {
            const modal = document.getElementById('javalab-modal');
            const iframe = document.getElementById('javalab-iframe');
            iframe.src = "https://javalab.org/en/boiling_point_en/";
            modal.classList.remove('hidden');
        }
        function closeModal() {
            const modal = document.getElementById('javalab-modal');
            const iframe = document.getElementById('javalab-iframe');
            iframe.src = "";
            modal.classList.add('hidden');
        }
        
        // --------- HỆ THỐNG TƯƠNG TÁC AI ---------
        const apiKey = "";
        async function handleAIChat(event, tabId) { /* ... */ }
        async function callGemini(promptText) { /* ... */ }

        // --------- KHỞI TẠO KHI TẢI TRANG ---------
        window.onload = () => {
            setupMeltingCanvas();
            startQuiz();
            if (window.renderMathInElement) {
                renderMathInElement(document.body, { delimiters: [{left: "$", right: "$", display: false}] });
            }
            document.getElementById('lang-switcher').addEventListener('click', () => {
                const newLang = currentLanguage === 'vi' ? 'de' : 'vi';
                setLanguage(newLang);
            });
        };
    </script>
</body>
</html>
